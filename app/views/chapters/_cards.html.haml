%p.minor_title
  = "#{t('text.chapter-prefix')} #{chapter}"
  = link_to "[#{t('actions.hide')}]", '#', :remote => true, :class=>"subscript", :id => "toggle_chapter_#{chapter}"
  :javascript
    $j('#toggle_chapter_#{chapter}').click(function(event)
    {
      if ($j('#toggle_chapter_#{chapter}').text() == "[hide]")
      {
        $j('#cards_for_chapter_#{chapter}').hide();
        $j('#toggle_chapter_#{chapter}').text('[show]');
      }
      else
      {
        $j('#cards_for_chapter_#{chapter}').show();
        $j('#toggle_chapter_#{chapter}').text('[hide]');
      }

      event.stopPropagation();
    });
  = link_to "[#{t('actions.cram')}]", cram_deck_chapter_path(deck.id, chapter), :class=> "subscript"
#cards_for_chapter{:id => "#{chapter}"}
  - @cards.each do |card|
    .div{:class => "card_panel left", :style => ""}
      %p{:class => "tiny_option text_right"}
        = link_to "edit", edit_deck_card_path(deck.id, card.id)
      %p{:class => "centre mandarin"}= link_to card.front, "#?w=750&h=600", :rel => "popup_name_#{card.id}", :class => "poplight"
      - if card.audio.file?
        .div{:class => "", :style => "margin-left:auto; margin-right: auto;  width: 35px"}
          =render :partial => '/audio_controls_start_only', :locals => {:id => card.id, :audio_url => card.audio.url}
      - if is_pronunciation_on_front? deck.pronunciation_side
        .pad_from_top
        %p{:class => "minor_title centre"}= "[#{card.pronunciation}]"
    #popup_name{:id => "#{card.id}", :class => "popup_block"}
      %p{:class => "giant mandarin"}= card.front
      - if is_pronunciation_on_front? deck.pronunciation_side
        .pad_from_top
        %p{:class => "minor_title centre"}= "[#{card.pronunciation}]"
      .section_break
      .pad_from_top
      %p{:class => "huge mandarin"}= card.back
      - if is_pronunciation_on_back? deck.pronunciation_side
        .pad_from_top
        - unless card.pronunciation.nil?
          - words = {}
          %div{:class => "centre inline-block"}
            - card.pronunciation.split(' ').each do |word|
              %div{:class => "left", :style => "padding: 0.6em;"}
                %p{:class => "minor_title"}= word
                %p= (get_pronunciation_expansion word).html_safe
            .pad

:javascript
  http://www.sohtanaka.com/web-design/inline-modal-window-w-css-and-jquery
  $j(document).ready(function() {
    $j('a.poplight[href^=#]').click(function() {
      var popID = $j(this).attr('rel'); //Get Popup Name
      var popURL = $j(this).attr('href'); //Get Popup href to define size

      //Pull Query & Variables from href URL
      var query= popURL.split('?');
      var dim= query[1].split('&');
      var popWidth = dim[0].split('=')[1]; //Gets the first query string value
      var popHeight = dim[1].split('=')[1]; //Gets the second query string value

      //Fade in the Popup and add close button
      //$j('#' + popID).fadeIn().css({ 'width': Number( popWidth ) });
      $j('#' + popID).fadeIn().css({ 'width': Number( popWidth ), 'height' : Number (popHeight) }).prepend('<a href="#" class="close right"><p class="btn_close">#{t('actions.close')}</p></a>');
      //.prepend('<a href="#" class="close"><img src="close_pop.png" class="btn_close" title="Close Window" alt="Close" /></a>');

      //Define margin for center alignment (vertical   horizontal) - we add 80px to the height/width to accomodate for the padding  and border width defined in the css
      var popMargTop = ($j('#' + popID).height() + 80) / 2;
      var popMargLeft = ($j('#' + popID).width() + 80) / 2;

      //Apply Margin to Popup
      $j('#' + popID).css({
          'margin-top' : -popMargTop,
          'margin-left' : -popMargLeft
      });

      //Fade in Background
      $j('body').append('<div id="fade"></div>'); //Add the fade layer to bottom of the body tag.
      $j('#fade').css({'filter' : 'alpha(opacity=80)'}).fadeIn(); //Fade in the fade layer - .css({'filter' : 'alpha(opacity=80)'}) is used to fix the IE Bug on fading transparencies

      return false;
    });
  });

  //Close Popups and Fade Layer
  $j('.popup_block, a.close, #fade').live('click', function() {
      $j('#fade, a.close, .popup_block').fadeOut(function() {
          $j('#fade').remove();
      });
      return false;
  });